<div id="XtreamSeriesPage" data-role="page" class="page type-interior pluginConfigurationPage withTabs"
  data-require="emby-input,emby-button" data-controller="__plugin/XtreamSeries.js">
  <div data-role="content">
    <div class="content-primary">
      <form id="XtreamSeriesForm">
        <div class="checkboxContainer checkboxContainer-withDescription">
          <label>
            <input is="emby-checkbox" id="Visible" name="Visible" type="checkbox" />
            <span>Show this channel to users</span>
          </label>
        </div>
        <div class="checkboxContainer checkboxContainer-withDescription">
          <label>
            <input is="emby-checkbox" id="FlattenSeriesView" name="FlattenSeriesView" type="checkbox" />
            <span>Flatten Series View</span>
          </label>
          <div class="fieldDescription">
            When enabled, all series from selected categories appear directly in the library without category folders. Seasons and episodes remain organized under each series.
          </div>
        </div>
        <div class="sectionTitleContainer flex align-items-center" style="margin-top: 1em;">
          <h2 class="sectionTitle">Cache Settings</h2>
        </div>
        <div class="checkboxContainer checkboxContainer-withDescription">
          <label>
            <input is="emby-checkbox" id="EnableCaching" name="EnableCaching" type="checkbox" />
            <span>Enable Series Caching</span>
          </label>
          <div class="fieldDescription">
            Pre-fetch and cache all series data for faster navigation. When disabled, data is fetched on-demand from the Xtream server.
          </div>
        </div>
        <div id="CacheOptionsContainer" style="display: none;">
          <div class="inputContainer">
            <label class="inputLabel" for="SeriesCacheRefreshMinutes">Refresh Frequency (minutes)</label>
            <input is="emby-input" type="number" id="SeriesCacheRefreshMinutes" name="SeriesCacheRefreshMinutes" min="10" max="1380" />
            <div class="fieldDescription">
              How often to automatically refresh the cache (default: 600 minutes / 10 hours, min: 10, max: 1380 / 23 hours). Maximum is 23 hours to ensure refresh happens before 24-hour cache expiration. This setting syncs with Dashboard → Scheduled Tasks.
            </div>
          </div>
          <div class="inputContainer">
            <label class="inputLabel" for="CacheRefreshParallelism">Cache Refresh Parallelism: <span id="CacheParallelismValue">3</span></label>
            <input type="range" id="CacheRefreshParallelism" name="CacheRefreshParallelism" min="1" max="10" value="3" style="width: 100%;" />
            <div class="fieldDescription">
              Number of concurrent API requests during cache refresh. Lower values (1-2) are safer for strict providers. Higher values (5-10) are faster but may trigger rate limiting. Default: 3 (recommended).
            </div>
          </div>
          <div class="inputContainer">
            <label class="inputLabel" for="CacheRefreshMinDelayMs">Request Throttle Delay (ms): <span id="CacheMinDelayValue">100</span></label>
            <input type="range" id="CacheRefreshMinDelayMs" name="CacheRefreshMinDelayMs" min="0" max="500" step="25" value="100" style="width: 100%;" />
            <div class="fieldDescription">
              Minimum delay between API requests to avoid rate limiting. 0 = no throttling, 100 = ~10 req/sec, 500 = ~2 req/sec. Default: 100ms.
            </div>
          </div>
          <div class="inputContainer" style="display: flex; gap: 10px; margin-bottom: 1em;">
            <button is="emby-button" type="button" id="RefreshCacheBtn" class="raised emby-button">
              <span>Refresh Now</span>
            </button>
            <button is="emby-button" type="button" id="ClearCacheBtn" class="raised emby-button" style="background-color: #c25;"
              title="Clears all cached data. Next refresh will fetch everything from scratch.">
              <span>Clear Cache</span>
            </button>
          </div>
          <div class="inputContainer" id="CacheStatusContainer" style="display: none;">
            <label class="inputLabel">Cache Refresh Status</label>
            <div id="CacheProgressBar" style="width: 100%; height: 20px; background-color: #2a2a2a; border-radius: 4px; overflow: hidden; margin: 8px 0;">
              <div id="CacheProgressFill" style="height: 100%; background-color: #00a4dc; width: 0%; transition: width 0.3s ease;"></div>
            </div>
            <div id="CacheStatusText" style="color: #a0a0a0; font-size: 0.9em; margin-top: 4px;">Idle</div>
            <div class="fieldDescription">
              Current cache refresh progress. You can also view this in Dashboard → Scheduled Tasks → "Refresh Xtream Series Cache".
            </div>
          </div>
        </div>
        <div class="sectionTitleContainer flex align-items-center" style="margin-top: 1em;">
          <h2 class="sectionTitle">Language Matching Booster</h2>
        </div>
        <div class="checkboxContainer checkboxContainer-withDescription">
          <label>
            <input is="emby-checkbox" id="UseTvdbForSeriesMetadata" name="UseTvdbForSeriesMetadata" type="checkbox" checked />
            <span>Enable TVDb Artwork Lookup</span>
          </label>
          <div class="fieldDescription">
            Fetch series artwork from TVDb using intelligent title matching. Falls back to Xtream provider images if no match is found.
          </div>
        </div>
        <div id="TvdbOptionsContainer">
          <div class="inputContainer">
            <label class="inputLabel" for="TvdbLanguagePreset">Language Preset</label>
            <select is="emby-select" id="TvdbLanguagePreset" name="TvdbLanguagePreset" class="emby-select-withcolor">
              <option value="">Custom (manual configuration)</option>
            </select>
            <div class="fieldDescription">
              Select your language to auto-fill common settings. You can still customize translations below.
            </div>
          </div>
          <div class="inputContainer">
            <label class="inputLabel" for="TvdbWordForAnd">Word for "and" in your language</label>
            <input is="emby-input" type="text" id="TvdbWordForAnd" name="TvdbWordForAnd" placeholder="e.g., en (Dutch), und (German), et (French)" />
            <div class="fieldDescription">
              Your language's word for "and". Used to find series like "Tom en Jerry" → "Tom & Jerry" on TVDb.
            </div>
          </div>
          <div class="inputContainer">
            <label class="inputLabel" for="TvdbLanguageArticle">Article prefix (like "The")</label>
            <input is="emby-input" type="text" id="TvdbLanguageArticle" name="TvdbLanguageArticle" placeholder="e.g., De (Dutch), Die (German), Le/La (French)" />
            <div class="fieldDescription">
              Your language's article prefix. "De Smurfen" → "The Smurfen" for TVDb search.
            </div>
          </div>
          <div class="inputContainer">
            <label class="inputLabel" for="TvdbSearchTranslations">Word Translations (one per line)</label>
            <textarea is="emby-textarea" id="TvdbSearchTranslations" name="TvdbSearchTranslations" rows="6"
              placeholder="Bouwers=Builders&#10;avonturen=Adventures&#10;vrienden=Friends" style="width: 100%; font-family: monospace;"></textarea>
            <div class="fieldDescription">
              Custom word translations for TVDb search. Format: LocalWord=EnglishWord (one per line).<br>
              Example: "Bouwers=Builders" makes "Bugs Bunny Bouwers" searchable as "Bugs Bunny Builders".
            </div>
          </div>
        </div>
        <div class="sectionTitleContainer flex align-items-center">
          <h2 class="sectionTitle">Series selection</h2>
        </div>
        <div class="inputContainer">
          <table class="categories-table">
            <thead>
              <tr>
                <th colspan="2">Category</th>
                <th>Display</th>
              </tr>
            </thead>
            <tbody id="SeriesContent">

            </tbody>
          </table>
        </div>
        <div>
          <button is="emby-button" type="submit" class="raised button-submit block emby-button">
            <span>Save</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>